\chapter{Название третьей главы: разработка программного обеспечения} \label{ch3}

% к реализации (из главы компоненты)
Для всех задач есть набор часто используемых утилит, таких как \texttt{jq}, \texttt{curl}, \texttt{git}, которые необходимы почти в каждом конвейере.
Они были добавлены в отдельный Docker образ, который используется в задачах по мере необходимости.
Поскольку слои образов кешируются в исполнителях CI/CD, скачивание образов происходит быстрее, чем их ручная установка в каждой задаче.

Хорошим стилем является наличие введения к главе. Во введении может быть описана цель написания главы, а также приведена краткая структура главы.


\section{Обеспечение правильной последовательности запуска конвейеров} \label{sec:pipelines-order}
Во время непосредственной работы с GitLab была найдена разница в последовательности выполнения конвейеров при новых изменениях проектов.
В GitHub выполнялись следующие правила:
\begin{itemize}
  \item Для запросов на слияние (merge requests): если в нем появляется новое изменения, все предыдущие конвейеры, связанные со старой версией кода данного запроса на слияние должны быть прерваны;
  \item Для изменений главной ветки проекта: если появляется несколько новых изменений репозитория, уже запущенный конвейер должен завершить свою работу, а следующий конвейер должен быть запущен для последнего изменения. Остальные промежуточные конвейеры отменяются.
\end{itemize}

Для реализации этих правил в GitLab используются следующие механизмы:
\begin{itemize}
  \item Параметр конфигурации конвейера автоматической отмены (auto\_cancel) , которая, логично, позволяет автоматически отменять конвейеры при определенных условиях. Например, при появлении нового изменения в запросе на слияние все предыдущие конвейеры, связанные с этим запросом, автоматически прерываются;
  \item Настройка проекта режима обработки конвейеров (process\_mode), доступная только через сетевой интерфейс приложения GitLab. Она определяет последовательность выполнения конвейеров в очереди, обеспечивая корректную обработку новых коммитов в главной ветке проекта;
  \item Использование групп ресурсов в конфигурации конвейеров, позволяющие ограничить количество одновременно выполняемых конвейеров одного вида при новых изменениях проекта;
  \item Отмена промежуточных конвейеров происходит засчет настройки репозитория в GitLab, позволяющей отменять все конвейры, созданные до последнего успешного конвейера.
\end{itemize}

Как итог, в GitLab получилось прийти к аналогичному GitHub поведению последовательности выполнения конвейеров.

\section{Адаптация автоматизации, уведомляющей об успешном разворачивании новой версии кода в окружении}
Сама автоматизация представляет собой шаг в процессе разворачивания проектов в Octopus Deploy, который добавляет комментарии в карточки задач и запросов на слияние кода из GitHub с уведомлением, что изменения, связанные с этими задачами и запросами, развернулись в определенном окружении.

Первоначально реализация представляла собой несколько сотен C\# кода, расположенных в шаблоне шагов из Octopus Deploy, использующий устаревший ScriptCS \cite{scriptcs}. Данный код не содержал обработку исключений и различные его ошибки могли привести к провалу всего разворачивания проекта в окружение. А также возникала проблема, что не на всех рабочих машинах Octopus Deploy был установлен C\#. Кроме проблем с существующим кодом требовалось добавить новую функциональность уведомлений карточек задач из Yandex Tracker \cite{yandextracker} и запросов на слияния в GitLab.

В связи с проблемами выше были сделано следующее:
\begin{itemize}
  \item Переписан существующий код, разбив его на несколько файлов и классов;
  \item Добавлена новая функциональность, связанная с GitLab и Yandex Tracker;
  \item Добавлена глобальная ловля исключений и все сетевые взаимодействия со сторонними сервисами были покрыты механизмами повторений попыток с экспоненциальным ростом ожидания между каждыми попытками для обеспечения стабильной работы шага;
  \item Код был помещен в образ Docker, который и используется в новом шаблон шага в Octopus Deploy.
\end{itemize}

После проделанной работы новый шаг был подключен во все 36 репозиториев отвечающих за клиентскую часть сервиса, а также в самый нагруженный по изменениям проект компании. Новых проблем выявлено не было.

\section{Название параграфа} \label{ch3:sec1}

\section{Название параграфа} \label{ch3:sec2}

%\FloatBarrier % заставить рисунки и другие подвижные (float) элементы остановиться


\section{Выводы} \label{ch3:conclusion}

Текст выводов по главе \thechapter.


%% Вспомогательные команды - Additional commands
%
%\newpage % принудительное начало с новой страницы, использовать только в конце раздела
%\clearpage % осуществляется пакетом <<placeins>> в пределах секций
%\newpage\leavevmode\thispagestyle{empty}\newpage % 100 % начало новой страницы
